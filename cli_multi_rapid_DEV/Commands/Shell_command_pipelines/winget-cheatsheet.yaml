# winget-cheatsheet.yaml
meta:
  title: "WinGet (Windows Package Manager) — Deterministic CLI Cheat Sheet"
  version: "2025-09-30"
  audience: "Automation-first workflows on Windows (scripts, CI, zero-touch setup)"
  notes:
    - "This file focuses on the most useful commands and flags for unattended, reproducible setups."
    - "Use with PowerShell/Windows Terminal. Pair with logs and exit codes for orchestration."

conventions:
  placeholders:
    <id>: "Package Id (e.g., Microsoft.VisualStudioCode)"
    <name>: "Display name (e.g., Visual Studio Code)"
    <moniker>: "Short name if defined (e.g., vscode)"
    <src>: "Source name (e.g., winget, msstore)"
    <file>: "Path to file"
    <dir>: "Path to directory"
    <ver>: "Version string (e.g., 1.92.2)"
  quoting: "Quote names with spaces: "Power Toys""
  admin_note: "Some installers require elevation; prefer Admin shell for full automation."
  scope_note: "Scope may vary by installer (user vs machine). Prefer MSI/MSIX for predictability."

global_flags:
  - flag: "--accept-package-agreements"
    desc: "Auto-accept package license/agreements (non-interactive)."
  - flag: "--accept-source-agreements"
    desc: "Auto-accept source repo agreements (non-interactive)."
  - flag: "--disable-interactivity"
    desc: "No prompts; required for CI/unattended runs."
  - flag: "--silent"
    alias: "--silent --force"  # pragmatic combo in some scripts
    desc: "Prefer quiet install when the package supports it."
  - flag: "--verbose-logs"
    desc: "Emit detailed logs for troubleshooting and auditing."
  - flag: "--logs"
    alias: "--open-logs"
    desc: "Open or locate the default logs directory quickly."
  - flag: "--proxy <url> | --no-proxy"
    desc: "Override proxy for the current command."
  - flag: "--source <src>"
    desc: "Target a specific repository (e.g., winget, msstore)."
  - flag: "--id <id> | --name <name> | --moniker <moniker>"
    desc: "Disambiguate package targets across commands."
  - flag: "--exact"
    desc: "Exact match for search/install targets."
  - flag: "--version <ver>"
    desc: "Install/upgrade to a specific version where supported."

commands:

  - name: "search"
    purpose: "Discover packages and resolve exact IDs for scripting."
    primary_flags:
      - "--query <string>"
      - "--id <id> | --name <name> | --moniker <moniker> | --tag <tag> | --command <command>"
      - "--source <src>"
      - "--exact"
    examples:
      - "winget search vscode"
      - "winget search --id Microsoft.PowerToys --source winget --exact"
      - "winget search -q ""   # show all (PowerShell: use backtick-escaped quotes)"
    notes:
      - "Resolve the canonical --id before writing automation to avoid ambiguity."

  - name: "show"
    purpose: "Display detailed metadata for a package (versions, installer types)."
    primary_flags:
      - "--id <id> | --name <name> | --moniker <moniker>"
      - "--versions"
      - "--source <src>"
      - "--exact"
    examples:
      - "winget show --id Microsoft.VisualStudioCode --versions"
      - "winget show "Power Toys" --exact"

  - name: "install"
    purpose: "Install apps; cornerstone for bootstrap scripts."
    primary_flags:
      - "--id <id> | --name <name> | --moniker <moniker>"
      - "--version <ver>"
      - "--source <src>"
      - "--scope <user|machine>"
      - "--silent | --interactive"
      - "--location <dir>"
      - "--override <string>    # native installer arguments"
      - "--arguments <string>   # deprecated in favor of --override in many cases"
      - "--accept-package-agreements"
      - "--disable-interactivity"
    examples:
      - "winget install --id Microsoft.WindowsTerminal --silent --accept-package-agreements --disable-interactivity"
      - "winget install Microsoft.PowerToys Microsoft.VisualStudioCode  # multi-target install"
      - "winget install --id Git.Git --scope machine --override "/VERYSILENT /NORESTART""
    notes:
      - "Multi-target installs run sequentially; if an installer forks, WinGet may continue early—guard with retries."

  - name: "upgrade"
    aliases: ["update"]
    purpose: "Upgrade installed apps; use --all for fleet updates."
    primary_flags:
      - "--id <id> | --name <name>"
      - "--version <ver>"
      - "--all"
      - "--include-unknown"
      - "--silent"
      - "--accept-package-agreements"
      - "--disable-interactivity"
    examples:
      - "winget upgrade --all --include-unknown --silent --accept-package-agreements --disable-interactivity"
      - "winget upgrade --id Microsoft.VisualStudioCode --version <ver>"

  - name: "list"
    purpose: "Inventory currently installed packages; feed into export/pin logic."
    primary_flags:
      - "--source <src>"
      - "--id <id> | --name <name>"
      - "--exact"
    examples:
      - "winget list"
      - "winget list --source winget --id Git.Git --exact"

  - name: "uninstall"
    purpose: "Remove a package cleanly."
    primary_flags:
      - "--id <id> | --name <name>"
      - "--silent"
      - "--purge    # if supported by the installer"
    examples:
      - "winget uninstall --id Discord.Discord --silent"

  - name: "export"
    purpose: "Snapshot your environment to a packages file (JSON)."
    primary_flags:
      - "--output <file>"
      - "--source <src>"
      - "--include-versions"
    examples:
      - "winget export --output .\machine.packages.json --include-versions"
    notes:
      - "Use as an atomic savepoint of toolset; commit the file to the repo."

  - name: "import"
    purpose: "Bulk install from an export file."
    primary_flags:
      - "--import-file <file>"
      - "--accept-package-agreements"
      - "--disable-interactivity"
      - "--silent"
    examples:
      - "winget import --import-file .\machine.packages.json --silent --accept-package-agreements --disable-interactivity"
    notes:
      - "Best used after validating availability of all IDs to avoid partial success."

  - name: "pin"
    purpose: "Lock packages to versions to prevent unexpected upgrades."
    subcommands:
      - "add    # create a pin"
      - "remove # delete a pin"
      - "list   # list pins"
      - "reset  # clear pins (use --force)"
    primary_flags:
      - "--id <id>"
      - "--version <ver>"
      - "--force   # for reset"
    examples:
      - "winget pin add --id Git.Git --version 2.47.0"
      - "winget pin list --id Microsoft.PowerToys"
      - "winget pin reset --force"
    notes:
      - "Use pins to enforce deterministic CI and local dev parity."

  - name: "configure"
    purpose: "Apply declarative machine state via YAML + PowerShell DSC."
    subcommands:
      - "show      # display details of a config file"
      - "test      # compare current system vs desired state"
      - "validate  # schema/semantics validation"
    primary_flags:
      - "--file <file>   # .dsc.yaml"
      - "--disable-interactivity"
      - "--verbose-logs"
    examples:
      - "winget configure --file .\.det-tools\env\devbox.dsc.yaml --disable-interactivity --verbose-logs"
      - "winget configure test --file .\.det-tools\env\devbox.dsc.yaml"
      - "winget configure validate --file .\.det-tools\env\devbox.dsc.yaml"
    notes:
      - "Always review DSC resources; run in isolated VM/Sandbox before production."

  - name: "source"
    purpose: "Manage repositories (community, msstore, custom)."
    subcommands:
      - "list | add | remove | update | reset | export"
    primary_flags:
      - "--name <src>"
      - "--arg <url>"
      - "--type <Microsoft.PreIndexed.Package | Microsoft.Rest | msstore | ...>"
      - "--accept-source-agreements"
    examples:
      - "winget source list"
      - "winget source add -n mysource -t Microsoft.Rest -a https://packages.example.org --accept-source-agreements"
      - "winget source export winget"

  - name: "download"
    purpose: "Fetch installers (and license) without installing—useful for offline caches."
    primary_flags:
      - "--id <id>"
      - "--version <ver>"
      - "--platform <Windows.Desktop|Windows.Universal|Windows.Holographic>"
      - "--download-directory <dir>"
      - "--skip-license"
    examples:
      - "winget download --id Git.Git --download-directory .\cache"
      - "winget download --id Some.Store.App --skip-license  # avoids license step"

  - name: "hash"
    purpose: "Generate SHA256 for installers you plan to submit or verify."
    primary_flags:
      - "--file <file>"
    examples:
      - "winget hash --file .\installer.exe"

  - name: "validate"
    purpose: "Validate a package manifest before submitting to the community repo."
    primary_flags:
      - "--manifest <file|dir>"
    examples:
      - "winget validate --manifest .\manifests\My.App\1.0.0"

  - name: "info"
    purpose: "Show environment metadata (version, arch, log dir)."
    examples:
      - "winget info"

  - name: "features"
    purpose: "Show experimental feature flags and status (useful when testing previews)."
    examples:
      - "winget features"

  - name: "settings"
    purpose: "Open/edit settings.json to tweak defaults (e.g., telemetry, behavior)."
    examples:
      - "winget settings"

recipes:  # opinionated building blocks for your pipelines
  - name: "quiet_bulk_install_core_tools"
    desc: "Install a baseline toolset silently and non-interactively."
    steps:
      - "winget install Microsoft.WindowsTerminal Microsoft.PowerToys Microsoft.VisualStudioCode --silent --accept-package-agreements --disable-interactivity --verbose-logs"

  - name: "export_toolset_snapshot"
    desc: "Create a committed snapshot for deterministic re-provisioning."
    steps:
      - "winget export --output .\.det-tools\snapshots\toolset.json --include-versions"

  - name: "import_toolset_snapshot"
    desc: "Apply a snapshot onto a clean machine or CI runner."
    steps:
      - "winget import --import-file .\.det-tools\snapshots\toolset.json --silent --accept-package-agreements --disable-interactivity --verbose-logs"

  - name: "enforce_versions_with_pins"
    desc: "Prevent drift by pinning critical tools to known-good versions."
    steps:
      - "winget pin add --id Git.Git --version 2.47.0"
      - "winget pin add --id Microsoft.VisualStudioCode --version 1.92.2"

  - name: "declare_machine_state_dsc"
    desc: "Drive full environment setup via DSC-backed configuration."
    steps:
      - "winget configure validate --file .\.det-tools\env\devbox.dsc.yaml"
      - "winget configure test --file .\.det-tools\env\devbox.dsc.yaml"
      - "winget configure --file .\.det-tools\env\devbox.dsc.yaml --disable-interactivity --verbose-logs"

operational_tips:
  logging_paths:
    note: "Use --verbose-logs and capture logs in CI artifacts for auditability."
  exit_codes:
    note: "Honor WinGet exit codes; implement retries for transient CDN or source errors."
  store_and_certs:
    note: "In enterprise, avoid bypassing certificate pinning; prefer Intune/GPO alignment."
  installer_types:
    note: "Prefer MSI/MSIX for predictable silent args; EXE installers vary widely."